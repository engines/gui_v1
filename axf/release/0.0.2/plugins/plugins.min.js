"use strict";ax.extension.appkit={},ax.extension.appkit.transition={},ax.extension.appkit.put=function(e,t={}){let a,n=!1===t.indent?null:t.indent||2;return a=ax.is.object(e)?JSON.stringify(e,null,n):e.toString(),ax.a.pre(a)},ax.extension.appkit.widget={},ax.extension.appkit.report=function(e,t={}){if(ax.is["function"](e)){let a=t.scope||[];ax.is.string(a)&&(a=[a]),e=e(ax.x.appkit.report.factory({scope:a,data:t.data,layout:t.layout}))}return ax.a["appkit-report"](e,t.reportTag)},ax.extension.appkit.lib={},ax.extension.appkit.form=function(e={}){let t,a=ax.a,n=ax.x,i=e.params||{},o=e.dataParam,r=e.data||i[o]||{},l=e.proxy,p=e.form||(()=>[]),s=ax.x.appkit.form.factory({scope:e.scope,data:r,params:i,layout:e.layout,proxy:l});t=p(l?l(s):s);let c={id:e.id,"class":e["class"],style:e.style,title:e.title,action:e.action,method:e.method||"post",enctype:e.enctype,$focus:function(){let e=this.$controls()[0];e&&e.$focus()},$value:function(){return result={},this.$controls().forEach(e=>{e.$key&&(result[e.$key]=e.$value())}),result},$disable:function(){this.$controls().forEach(e=>e.$disable())},$enable:function(){this.$controls().forEach(e=>e.$enable())},$controls:function(){return n.appkit.form.factory.control.childControls(this)},$dependencies:function(){this.$$("appkit-form-field-dependent").$process()},...e.formTag};return a["appkit-form-wrapper"](a["appkit-form-section"](a.form(t,c)),e.formWrapperTag)},ax.extension.appkit.cycle=function(e,t,a={}){let n=ax.a;ax.x;t=t||500;let i=e.length-1,o={$state:0,$nodes:function(){return e[this.$state]},$init:function(){let e=function(){setTimeout(function(){this.$state===i?this.$state=0:this.$state++,e()},t)};e()}};return n["appkit-cycle"](o,a.cycleTag)},ax.extension.appkit.list=function(e,t={}){let a=ax.a,n=ax.x;t.functions;return a["appkit-list"](n.appkit.list.element(e),t.listTag)},ax.extension.appkit.router=((e,t={})=>(a,n)=>{let i={scope:t.scope||"","default":t["default"],home:t.home};t.home&&window.location.pathname.match(/^$|^\/$/)&&window.history.replaceState({},"Home",t.home);let o={id:t.id,$init:e=>{const t=function(){let e=this.$location();this.$load(e.path,e.query,e.anchor)}.bind(e);window.addEventListener("popstate",t)},$nodes:function(){if(ax.is["function"](e)){let t=n.appkit.router.controller({router:[this],...i})(this.$location());return e(t)}return e},$config:i,$open:function(e,t,a){"/"===e[0]?this.$locate(e,t,a):(e=i.scope+(e?`/${e}`:""),this.$locate(e,t,a))},$locate:function(e,t,a){e=(e||"/")+((t=n.appkit.lib.query.from.object(t))?"?"+t:"")+(a?"#"+a:""),history.pushState({urlPath:e},"",e);let i=new PopStateEvent("popstate",{urlPath:e});dispatchEvent(i)},$location:function(){let e=window.location;return{href:`${e.pathname}${e.search}${e.hash}`,path:e.pathname,query:n.appkit.lib.query.to.object(e.search.slice(1)),anchor:e.hash.slice(1)}},$load:function(e,t,a){this.$$("appkit-router-routes").$$.forEach(n=>{1===n.$config.router.length&&n.$load(e,t,a)})},...t.routerTag};return a["appkit-router"](o)}),ax.extension.appkit.icon=function(e,t,a={}){ax.a,ax.x;var n=[ax.a.span({"class":e})];t&&(a.compact||n.push(""),n.push(t)),a.reverse&&n.reverse();let i={style:{whiteSpace:"nowrap"},...a.iconTag};return ax.a["appkit-icon"](n,i)},ax.extension.appkit.time=function(e={}){const t=ax.a;let a=Object.assign({$init:function(){this.$tock(),setInterval(this.$tock,1e3)},$tock:function(){this.$text=(new Date).toLocaleTimeString()}},e.timeTag);return t.time(null,a)},ax.extension.appkit.table=function(e,t={}){let a,n=[],i=function(e,a){return ax.is["function"](t.trTag)?t.trTag(e,a):t.trTag},o=function(e,a,n){return ax.is["function"](t.thTag)?t.thTag(e,a,n):t.thTag},r=function(e,a,n){return ax.is["function"](t.tdTag)?t.tdTag(e,a,n):t.tdTag};a=!1===t.headers?{rows:[],cols:[]}:!0!==t.headers&&t.headers?{rows:t.headers.rows||[],cols:t.headers.cols||[]}:{rows:[0],cols:[]};let l=function(e,t,n){if(a.rows.includes(e)){let a={scope:col,...o(e,t,n)};return ax.a.th(n,a)}if(a.cols.includes(t)){let a={scope:row,...o(e,t,n)};return ax.a.th(n,a)}return ax.a.td(n,r(e,t,n))};return e.map(function(e,t){n.push(ax.a.tr(e.map(function(e,a){return l(t,a,e)}),i(t,e)))}),ax.a.table(n,t.tableTag)},ax.extension.appkit.http=function(e,t={}){let a=ax.a,n=(ax.x,(e,t)=>t.$nodes=a["appkit-http-result"]([e])),i=(e,t)=>t.$nodes=a["appkit-http-result.error"]([e]),o=t.handlers||{},r=function(e,a,o){let r,l=(t.status||{})[o.status],p=o.status;p>=200&&p<300?(a.$send("axfAppkitHttpSuccess"),r=l||t.success||n):(a.$send("axfAppkitHttpError"),r=l||t.error||i),r(e,a,o),a.$send("axfAppkitHttpComplete")};return a["appkit-http"]({$nodes:t.placeholder||null,$init:a=>{a.$send("axfAppkitHttpStart"),fetch(e,{method:t.method,body:t.body,headers:{}}).then(e=>{let t=e.headers.get("content-type");if(t){t=t.split(";")[0];let n=o[t];if(n)n.bind(a)(e,a);else switch(t){case"application/json":e.json().then(t=>{r(t,a,e)});break;case"text/plain":case"text/html":e.text().then(t=>{r(t,a,e)});break;default:ax["throw"](`Unhandled content-type '${t}'.`)}}else r(null,a,e)})["catch"](e=>{ax.log.error("Ax appkit http error.",e.message),t["catch"]&&t["catch"](e,a)})}},t.httpTag)},ax.extension.appkit.fieldForm=function(e={}){let t=ax.a;ax.x;return t["appkit-field-form"](this.form({...e,proxy:this.fieldForm.factory}))},ax.extension.appkit.button=function(e,t,a={}){let n={id:a.id,"class":a["class"],type:a.type||"button",name:a.name,value:a.value,disabled:a.disabled,style:a.style,title:a.title,$on:{click:function(e){t.bind(this)(e,this,this.$state)}},...a.buttonTag};return ax.a.button(e,n)},ax.extension.appkit.router.controller=(e=>t=>((e={...e}).scope=e.scope||"",e.match=e.match||{},e.splat=e.splat||[],e.slash=e.slash||"",{href:t.href,path:t.path,query:t.query,anchor:t.anchor,scope:e.scope,match:e.match,splat:e.splat,slash:e.slash,params:{...e.match,...t.query},routes:ax.x.appkit.router.controller.routes(e,t),open:ax.x.appkit.router.controller.open(e)})),ax.extension.appkit.form.dependencies=function(){return function(){let e=this.$$("appkit-form-field-dependent").$$;e.forEach(function(t){let a;e.forEach(function(e){!t.isSameNode(e)&&e.contains(t)&&(a=!0)}),a||t.$process()});let t=this.$$("appkit-form-one, appkit-form-field-many").$$;t.forEach(function(e){let a;t.forEach(function(t){!e.isSameNode(t)&&t.contains(e)&&(a=!0)}),a||(ax.is.not["function"](e.$dependencies),e.$dependencies())})}},ax.extension.appkit.form.lib={},ax.extension.appkit.form.proxy={},ax.extension.appkit.form.factory=function(e){return new Proxy(ax.extension.appkit.form.proxy["function"](e),ax.extension.appkit.form.proxy.shim)},ax.extension.appkit.report.item=function(e,t={}){if(ax.is["function"](e)){let a=t.scope||[];ax.is.string(a)&&(a=[a]),e=e(ax.x.appkit.report.factory({scope:a,data:t.data,layout:t.layout}))}return ax.a["appkit-report-item"](e,t.itemTag)},ax.extension.appkit.report.proxy={},ax.extension.appkit.report.factory=function(e){return new Proxy(ax.extension.appkit.report.proxy.object(e),ax.extension.appkit.report.proxy.shim)},ax.extension.appkit.transition.crossfade=function(e={}){let t=ax.a,a=ax.x,n=(e.time||500)/2,i=e.initial;return t["appkit-transition"]({$init:function(){this.style.display="none",i&&(this.$component=i,this.$in())},$in:function(){this.$nodes=this.$component,a.appkit.lib.animate.fade["in"](this,{time:n})},$to:function(e){e=ax.factory(e),this.$component=e,"none"===this.style.display?this.$in():a.appkit.lib.animate.fade.out(this,{time:n,complete:this.$in.bind(this)})}})},ax.extension.appkit.transition.fadein=function(e={}){let t=ax.a,a=ax.x,n=(e.time||500)/2,i=e.initial;return t["appkit-transition"]({$init:function(){this.style.display="none",i&&(this.$component=i,this.$in())},$in:function(){this.$nodes=this.$component,a.appkit.lib.animate.fade["in"](this,{time:n})},$to:function(e){e=ax.factory(e),this.$component=e,this.$in()}})},ax.extension.appkit.widget.clock=function(e={}){const t=ax.a;let a=Object.assign({$init:function(){this.$tock(),setInterval(this.$tock.bind(this),1e3)},$tock:function(){this.$text=(new Date).toLocaleString()}},e.timeTag);return t["appkit-widget-time"](a)},ax.extension.appkit.list.element=function(e){let t=ax.a,a=ax.x;return ax.is.array(e)?t.ol(e.map(e=>t.li(a.appkit.list.element(e)))):ax.is["null"](e)?t["appkit-list-type-null"](null):ax.is["function"](e)?t["appkit-list-type-null"](`\ud835\udc53 ${e}`):ax.is.object(e)?t.ul(Object.keys(e).map(n=>t.li([t.label(n)," ",a.appkit.list.element(e[n])]))):ax.is.number(e)?t["appkit-list-type-number"](e):t["appkit-list-type-text"](e)},ax.extension.appkit.fieldForm.factory=function(e){let t=ax.x;return new Proxy(t.appkit.fieldForm.factory.object(e),t.appkit.fieldForm.factory.shim(e))},ax.extension.appkit.lib.url={},ax.extension.appkit.lib.field={},ax.extension.appkit.lib.text={},ax.extension.appkit.lib.uuid={},ax.extension.appkit.lib.object={},ax.extension.appkit.lib.coerce={},ax.extension.appkit.lib.query={},ax.extension.appkit.lib.element={},ax.extension.appkit.lib.animate={},ax.extension.appkit.lib.array={},ax.extension.appkit.lib.tabable=function(e){if(e.tabIndex>=0&&ax.x.appkit.lib.element.visible(e)){let t=e.closest("appkit-form-field appkit-form-field-dependent");return!t||t.$match()}return!1},ax.extension.appkit.lib.date={},ax.css({"appkit-form-field":{display:"block"},"appkit-form-field-helpbutton":{cursor:"pointer"}}),ax.extension.appkit.router.controller.open=(e=>(function(t,a={},n=null){let i,o,r,l;if("!"===t[0]&&(r=!0,t=t.slice(1)),i=t.match(/^(>+)(.*)/)){let t=i[1].length;l=i[2],o=e.router[t]}else if(i=t.match(/^(<+)(.*)/)){let t=i[1].length;l=i[2],o=e.router[e.router.length-t-1]}else"/"===t[0]?(l=t,o=e.router[0]):"%"===t[0]?(l=this.scope+t.slice(1),o=e.router[0]):(l=this.path+t,o=e.router[0]);r?o.$load(l,a,n):o.$open(l,a,n)})),ax.extension.appkit.router.controller.routes=((e,t)=>(function(a,n={}){let i,o;(e={...e})["default"]=n["default"]||e["default"],e.routes=a;let r=ax.x.appkit.router.controller.routes.transition(n.transition),l=ax.x.appkit.router.controller.routes.view(e);r?(i=function(){let e=l(this,t);this.$scope=e.scope,this.$("appkit-transition").$to(e.component)},o=[r]):o=function(){let e=l(this,t);return this.$scope=e.scope,e.component};let p={id:n.id,$config:e,$init:i,$nodes:o,$open:function(t,a,n){ax.log(toLocation),"/"===t[0]?e.router[0].$open(t,a,n):(t=this.$scope+(t?`/${t}`:""),e.router[0].$open(t,a,n))},$load:function(e,t,a){let i={path:e,query:t,anchor:a},o=l(this,i);if(n.lazy&&this.$scope===o.scope){let e=i;this.$$("appkit-router-routes").$$.forEach(t=>{t.$config.router.length===this.$config.router.length+1&&t.$load(e.path,e.query,e.anchor)})}else this.$scope=o.scope,r?this.$("appkit-transition").$to(o.component):this.$nodes=o.component},...n.routesTag};return e=>e["appkit-router-routes"](p)})),ax.extension.appkit.form.proxy.shim={get:(e,t,a)=>ax.is["function"](e[t])?e[t](a):e.hasOwnProperty(t)?e[t]:void ax.log.error(`The appkit form factory does not have property '${t}'.`)},ax.extension.appkit.form.proxy["function"]=function(e){return{scope:e.scope||[],data:e.data||{},params:e.params||{},layout:e.layout||{},proxy:e.proxy,...ax.x.appkit.form.factory}},ax.extension.appkit.form.factory.control=(e=>(function(t={}){let a,n=ax.a,i=t.as;return i?(a=(i=i.split(":"))[0]||t.control||"input",t.type=i[1]||t.type):a=t.control||"input",t.label=t.control,n["appkit-form-control"](e[a]({key:t.key,name:t.name,value:t.value,type:t.type,autocomplete:t.autocomplete,disabled:t.disabled,readonly:t.readonly,style:t.style,title:t.title,placeholder:t.placeholder,required:t.required,multiple:t.multiple,pattern:t.pattern,maxlength:t.maxlength,minlength:t.minlength,max:t.max,min:t.min,invalid:t.invalid,confirm:t.confirm,datatype:t.datatype,collection:t.collection,checked:t.checked,unchecked:t.unchecked,label:t.epithet,form:t.form,item:t.item,layout:t.layout,...t[a]}),t.controlTag)})),ax.extension.appkit.form.factory.lib={},ax.extension.appkit.form.factory.element=function(){return new Proxy(ax.extension.appkit.form.factory.element.proxy.object,ax.extension.appkit.form.factory.element.proxy.shim)},ax.extension.appkit.report.proxy.object=function(e){return{scope:e.scope||[],data:e.data||{},params:e.params||{},layout:e.layout,...ax.extension.appkit.report.factory}},ax.extension.appkit.report.proxy.shim={get:(e,t,a)=>fixregex&&t.match(/^scope|data|params|layout|index|toJSON|toString$/)?e[t]:ax.is["function"](e[t])?e[t](a):void ax.log.error(`The appkit report factory does not have property '${t}'`)},ax.extension.appkit.fieldForm.factory.object=function(){return{}},ax.extension.appkit.fieldForm.factory.shim=function(e){return{get:(t,a)=>t.hasOwnProperty(a)?t[a]:e[a]}},ax.extension.appkit.lib.element.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ax.extension.appkit.lib.query.from={},ax.extension.appkit.lib.query.to={},ax.extension.appkit.lib.date.now={},ax.extension.appkit.lib.text.humanize=function(e=""){return e.toString().replace(/_/g)},ax.extension.appkit.lib.text.labelize=function(e=""){return this.capitalize(e.toString().replace(/_/g," "))},ax.extension.appkit.lib.text.capitalize=function(e=""){return e.toString().charAt(0).toUpperCase()+e.slice(1)},ax.extension.appkit.lib.uuid.generate=function(){return"00000000-0000-4000-0000-000000000000".replace(/0/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))},ax.extension.appkit.lib.animate.fade={},ax.extension.appkit.lib.object.dig=function(e,t){let a=e;for(let e in t){if(null==a)return null;a=a[t[e]]||null}return a},ax.extension.appkit.lib.object.assign=function(e,t,a){let n=t[0],i=t.length;if(1===i)""===n?e.push(a):e[n]=a;else{let o=t[1];if(""===n){let t=e.length-1,a=e[t];n=ax.is.object(a)&&(i>2||ax.is.undefined(a[o]))?t:t+1}ax.is.undefined(e[n])&&(e[n]=""===o?[]:{}),this.assign(e[n],t.slice(1),a)}},ax.extension.appkit.lib.object.sort=function(e){let t={};return Object.keys(e).sort().forEach(function(a){t[a]=e[a]}),t},ax.extension.appkit.lib.coerce.number=function(e){return Number(e)},ax.extension.appkit.lib.coerce.boolean=function(e){let t=(e=e||!1).toString().toLowerCase();return e&&"false"!==t&&"off"!==t&&"0"!==t},ax.extension.appkit.lib.coerce.string=function(e){return ax.is.undefined(e)?"":String(e)},ax.extension.appkit.lib.tabable.previous=function(e){let t,a,n=Array.from(document.querySelectorAll("*")),i=n.indexOf(e),o=n.length,r=i;do{if(0===--r&&(r=o-1),r===i)return e;a=this(t=n[r])}while(!a);return t},ax.extension.appkit.lib.tabable.next=function(e){let t=Array.from(document.querySelectorAll("*"));e=Array.from(e.querySelectorAll("*")).slice(-1)[0]||e;let a,n,i=t.indexOf(e),o=t.length,r=i;do{if(++r===o&&(r=0),r===i)return e;n=this(a=t[r])}while(!n);return a},ax.extension.appkit.router.controller.routes.view=(e=>(t,a)=>{let n,i,o=e.scope||"",r=a.path.slice(o.length),l=e["default"],p=e.match||[],s=e.splat||[],c=Object.keys(e.routes);for(let t in c){let a=c[t],u=ax.x.appkit.router.controller.routes.matcher(a,r);if(u){l=e.routes[a],s=[...s,...u.splat],p={...p,...u.params},n=u.slash,o+=u.scope,i=t;break}}if(o=o.replace(/\/$/,""),ax.is["function"](l)){let i=ax.x.appkit.router.controller({router:[...e.router,t],scope:o,match:p,splat:s,slash:n,"default":e["default"],transition:e.transition})(a);l=ax.a["appkit-router-view"](l(i),{$init:function(){if(a.anchor){let e=document.getElementById(a.anchor);e||ax.log.warn(`Appkit router view cannot find #${a.anchor}`),e&&e.scrollIntoView()}}})}return ax.is.undefined(l)&&ax.log.warn("Not found:",a),{component:l,scope:o}}),ax.extension.appkit.router.controller.routes.transition=(e=>{if(ax.is.string(e))return ax.x.appkit.transition[e]();if(ax.is.array(e)){let t=e[0],a=e[1];return ax.x.appkit.transition[t](a)}return e}),ax.extension.appkit.router.controller.routes.regexp=(e=>{let t=e.replace(/\*$/,"&&catchall&&").replace(/\*/g,"&&wildcard&&").replace(/\/\?/,"&&slash&&"),a=t.match(/(:\w+|&&wildcard&&|&&catchall&&|&&slash&&)/g)||[],n=[];return a.forEach(function(e){let a,i;"&&wildcard&&"===e?(a="*",i="([^\\/|^\\.]*)"):"&&catchall&&"===e?(a="**",i="(.*)"):"&&slash&&"===e?(a="?",i="(\\/?)"):(a=e.slice(1),i="([^\\/|^\\.]*)"),n.push(a),t=t.replace(e,i)}),{string:t="^"+t+"$",keys:n}}),ax.extension.appkit.router.controller.routes.matcher=((e,t)=>{let a,n={},i=[],o=ax.x.appkit.router.controller.routes.regexp(e),r=new RegExp(o.string),l=t.match(r);if(l){let e=o.keys,r=0;e.forEach(function(e,t){let o=l[t+1];"*"===e?i.push(o):"**"==e?(r+=o.length,i.push(o)):"?"==e?(r+=o.length,a=o):n[e]=o});let p=t.length-r,s=t.substring(0,p);return{params:n,splat:i,slash:a,scope:s}}return null}),ax.extension.appkit.form.factory.element.textarea=(e=>{let t=ax.a;ax.x;return t["appkit-form-element-wrapper"](t.textarea(e.value,{name:e.name,"class":e["class"],data:e.data,disabled:e.disabled,id:e.id,placeholder:e.placeholder,readonly:e.readonly,required:e.required,style:e.style,title:e.title},e.textareaTag),e.elementWrapperTag)}),ax.extension.appkit.form.factory.element.check=(e=>{let t=ax.a;ax.x;return t["appkit-form-element-wrapper"]([t.input({type:e.type||"checkbox",name:e.name,value:e.value,checked:e.checked,"class":e["class"],data:e.data,disabled:e.disabled,id:e.id,readonly:e.readonly,required:e.required,style:e.style,title:e.title,...e.inputTag}),t.label(e.label,{$on:{"click: click input":(e,t)=>{t.previousSibling.click()},...(e.labelTag||{}).$on},...e.labelTag})],e.elementWrapperTag)}),ax.extension.appkit.form.factory.element.input=(e=>{let t=ax.a;ax.x;return t["appkit-form-element-wrapper"](t.input({name:e.name,value:e.value,type:e.type,id:e.id,"class":e["class"],style:e.style,title:e.title,placeholder:e.placeholder,data:e.data,disabled:e.disabled,readonly:e.readonly,multiple:e.multiple,autocomplete:e.autocomplete,required:e.required,pattern:e.pattern,maxlength:e.maxlength,minlength:e.minlength,...e.inputTag}),e.elementWrapperTag)}),ax.extension.appkit.form.factory.element.proxy={},ax.extension.appkit.form.factory.element.select=(e=>{let t=ax.a,a=ax.x.appkit.form.factory.element.select.options(e);return t["appkit-form-element-wrapper"](t.select(a,{name:e.name,"class":e["class"],data:e.data,disabled:e.disabled,readonly:e.readonly,id:e.id,multiple:e.multiple,required:e.required,style:e.style,title:e.title,...e.selectTag}),e.elementWrapperTag)}),ax.extension.appkit.form.factory.element.button=(e=>{let t=ax.a;ax.x;return t["appkit-form-element-wrapper"](t.button(e.label,{name:e.name,"class":e["class"],data:e.data,disabled:e.disabled,id:e.id,readonly:e.readonly,required:e.required,style:e.style,title:e.title},e.buttonTag),e.elementWrapperTag)}),ax.extension.appkit.form.factory.one=(e=>(function(t={}){let a,n=ax.a,i=ax.x;if(ax.is["function"](t.form)){let n=t.scope||t.key?e.scope.concat(t.key):e.scope,o=t.value||{},r=t.params||e.params,l=t.layout||e.layout,p=t.proxy||e.proxy,s=i.appkit.form.factory({scope:n,data:o,params:r,layout:l,proxy:p});p&&(s=p(s)),a=t.form(s)}else a=t.form;a=n["appkit-form-control-one"](n["appkit-form-section"](a,t.controlOneTag));let o={$focus:function(){let e=this.$controls()[0];e&&e.$focus()},$value:function(){return result={},this.$controls().forEach(e=>{e.$key&&(result[e.$key]=e.$value())}),result},$disable:function(){this.$controls().forEach(e=>e.$disable())},$enable:function(){this.$controls().forEach(e=>e.$enable())},$controls:function(){return i.appkit.form.factory.control.childControls(this)},...t.controlOneWrapperTag};return n["appkit-form-control-one-wrapper"](a,o)})),ax.extension.appkit.form.factory.checkboxes=(e=>(t={})=>{let a=ax.a,n=ax.x;t.name=n.appkit.form.factory.lib.collectionName(t.name);let i=n.appkit.form.factory.lib.collection(t.collection).map(function(a){let n,i=t.value;return n=ax.is.array(i)?t.value.some(function(e){return e==a.value}):i==a.value,e.element.check({value:a.value,name:t.name,label:a.label,checked:n||undefined,...a.checkTag})});i=a["appkit-form-control-checkboxes"](i,t.controlCheckboxesTag);let o={$value:function(){return this.$$("input:checked").value.$$},$focus:function(){this.$("input").focus()},$disable:function(){this.$$("input").setAttribute("disabled","disabled")},$enable:function(){t.disabled||this.$$("input").removeAttribute("disabled")},$on:{"click: do nothing when readonly":e=>{t.readonly&&e.preventDefault()},...(t.controlCheckboxesWrapperTag||{}).$on},...t.controlCheckboxesWrapperTag};return a["appkit-form-control-checkboxes-wrapper"](i,o)}),ax.extension.appkit.form.factory.textarea=(e=>(t={})=>{let a=ax.a,n=(ax.x,e.element.textarea(t));n=a["appkit-form-control-textarea"](n,t.controlTextareaTag);let i={$value:function(){return this.$("textarea").value},$focus:function(){this.$("textarea").focus()},$disable:function(){this.$("textarea").setAttribute("disabled","disabled")},$enable:function(){t.disabled||this.$("textarea").removeAttribute("disabled")},...t.controlTextareaWrapperTag};return a["appkit-form-control-textarea-wrapper"](n,i)}),ax.extension.appkit.form.factory.field=(e=>t=>{let a=ax.a,n=ax.x,i=n.appkit.form.factory.field;n.appkit.lib.field;t.name=t.name||n.appkit.form.factory.lib.scopedName(e,t),t.key&&(t.value=e.data[t.key]||t.value);let o=a["appkit-form-control-field"]([i.header(t),i.help(t.help),e.control(t),i.hint(t.hint)],t.controlFieldTag);return!1!==t.dependent&&(o=i.dependent(e)(o,t.dependent)),a["appkit-form-field"](o,{name:t.name,$key:t.key,$match:function(){let e=this.$("appkit-form-field-dependent");return!e||e.$match()},$value:function(){return this.$("appkit-form-control > *").$value()},$focus:function(){this.$("appkit-form-control > *").$focus()},...t.fieldWrapperTag})}),ax.extension.appkit.form.factory.many=(e=>(t={})=>{let a=ax.a,n=(ax.x,e.element.many(t));n=a["appkit-form-control-many"](a["appkit-form-section"](n),t.controlManyTag);let i={$value:function(){return this.$("many").value},$focus:function(){this.$("many").focus()},$disable:function(){this.$("many").setAttribute("disabled","disabled")},$enable:function(){t.disabled||this.$("many").removeAttribute("disabled")},...t.controlWrapperTag};return a["appkit-form-control-many-wrapper"](n,i)}),ax.extension.appkit.form.factory.input=(e=>(t={})=>{let a=ax.a,n=ax.x;"file"==t.type&&t.multiple&&(t.name=n.appkit.form.factory.lib.collectionName(t.name));let i=e.element.input(t);if(i=a["appkit-form-control-input"](i,t.controlInputTag),t.confirm){let n={...t,id:null,name:null,title:t.title?`${t.title} confirmation`:null,...t.confirmationInput};i=a["appkit-form-input-confirmation-wrapper"]([i,a["appkit-form-input-confirmation"](e.element.input(n),t.confirmationTag)],{$on:{"input: check confirmation match":function(e,t){let a=t.$$("input");a[0].value==a[1].value?a[1].setCustomValidity(""):a[1].setCustomValidity("Confirmation must match.")},...(t.confirmationWrapperTag|{}).$on},...t.confirmationWrapperTag})}let o={$init:function(){this.$valid()},$value:function(){return this.$("input").value},$focus:function(){this.$("input").focus()},$disable:function(){let e,t=this.$$("input").$$;for(e of t)e.setAttribute("disabled","disabled")},$enable:function(){if(!t.disabled){let e,t=this.$$("input").$$;for(e of t)e.removeAttribute("disabled")}},$validity:function(){return this.$("input").validity},$valid:function(){if(this.$("input").setCustomValidity(""),this.$validity.valid)return!0;if(t.invalid)if(ax.is["function"](t.invalid)){let e=t.invalid(this.$value,this.$validity);e&&this.$("input").setCustomValidity(e)}else this.$("input").setCustomValidity(t.invalid);return!1},$on:{"input: check field depenencies":(e,t)=>{let a=t.$("^form");a&&a.$dependencies()},...(t.controlInputWrapperTag||{}).$on},...t.controlInputWrapperTag};return a["appkit-form-control-input-wrapper"](i,o)}),ax.extension.appkit.form.factory.checkbox=(e=>(t={})=>{let a=ax.a,n=(ax.x,ax.is.not.undefined(t.checked)?t.checked:"on"),i=e.element.check({...t,value:n,checked:t.value==n,...t.checkTag});ax.is.not.undefined(t.unchecked)&&(i=[e.input({name:t.name,value:t.unchecked,type:"hidden"}),i]),i=a["appkit-form-control-checkbox"](i,t.controlCheckboxTag);let o={$value:function(){return this.$("input[type=checkbox]").checked?t.checked||"on":t.unchecked},$focus:function(){this.$("input[type=checkbox]").focus()},$disable:function(){this.$("input[type=checkbox]").setAttribute("disabled","disabled"),this.$("input[type=hidden]")&&this.$("input[type=hidden]").setAttribute("disabled","disabled")},$enable:function(){t.disabled||(this.$("input[type=checkbox]").removeAttribute("disabled"),this.$("input[type=hidden]")&&this.$("input[type=hidden]").removeAttribute("disabled"))},$on:{"click: do nothing when readonly":e=>{t.readonly&&e.preventDefault()},...(t.controlCheckboxWrapperTag||{}).$on},...t.controlCheckboxWrapperTag};return a["appkit-form-control-checkbox-wrapper"](i,o)}),ax.extension.appkit.form.factory.submit=(e=>(function(t={}){let a=ax.a;ax.x;t.label=t.label||"Submit",t.disableWith=ax.is.not.undefined(t.disableWith)?t.disableWith:"Submitting...";let n=a["appkit-form-submit"](e.element.button({...t,$nodes:t.label,type:"submit",...t.buttonTag}),t.submitTag),i={$focus:function(){this.$("button").focus()},$disable:function(){this.$("button").setAttribute("disabled","disabled"),this.$("button").$nodes=t.disableWith},$enable:function(){this.$("button").removeAttribute("disabled"),this.$("button").$nodes=t.label},...t.controlTag};return a["appkit-form-control"](n,i)})),ax.extension.appkit.form.factory.radios=(e=>(t={})=>{let a=ax.a,n=ax.x.appkit.form.factory.lib.collection(t.collection).map(function(a){let n=t.value==a.value;return e.element.check({type:"radio",name:t.name,value:a.value,label:a.label,checked:n||undefined,...a.checkTag})});n=a["appkit-form-control-radios"](n,t.controlRadiosTag);let i={$value:function(){return this.$$("input:checked").value.$$},$focus:function(){this.$("input").focus()},$disable:function(){this.$$("input").setAttribute("disabled","disabled")},$enable:function(){t.disabled||this.$$("input").removeAttribute("disabled")},$on:{"click: do nothing when readonly":e=>{t.readonly&&e.preventDefault()},...(t.controlRadiosWrapperTag||{}).$on},...t.controlRadiosWrapperTag};return a["appkit-form-control-radios-wrapper"](n,i)}),ax.extension.appkit.form.factory.select=(e=>(t={})=>{let a=ax.a,n=ax.x;t.multiple&&(t.name=n.appkit.form.factory.lib.collectionName(t.name)),t.value=t.value||(t.multiple?[]:""),t.collection=n.appkit.form.factory.lib.collection(t.collection),ax.is.not.undefined(t.placeholder)?t.collection.unshift({value:"",label:t.placeholder}):t.required||t.collection.unshift({value:"",label:""});let i=e.element.select({disabled:t.disabled||t.readonly,...t});if(t.readonly){let e;i=[i,e=t.multiple?a.span(t.value.map(e=>a.input({type:"hidden",name:t.name,value:e}))):a.input({type:"hidden",name:t.name,value:t.value})]}i=a["appkit-form-control-select"](i,t.controlSelectTag);let o={$value:function(){return t.multiple?this.$$("option:checked").value.$$:this.$("select").value},$focus:function(){this.$("select").focus()},$disable:function(){this.$("select").setAttribute("disabled","disabled")},$enable:function(){t.disabled||this.$("select").removeAttribute("disabled")},$on:{"click: do nothing when readonly":e=>{t.readonly&&e.preventDefault()},...(t.controlSelectWrapperTag||{}).$on},...t.controlSelectWrapperTag};return a["appkit-form-control-select-wrapper"](i,o)}),ax.extension.appkit.form.factory.lib.collectionName=function(e){return e&&"[]"!=e.slice(-2)&&(e+="[]"),e},ax.extension.appkit.form.factory.lib.childControls=function(e){let t=e.$$("appkit-form-control").$$,a=[];return t.forEach(function(e){let n;t.forEach(function(t){!e.isSameNode(t)&&t.contains(e)&&(n=!0)}),n||a.push(e)}),a},ax.extension.appkit.form.factory.lib.collection=function(e){return e?ax.is.array(e)?e.map(function(e){return ax.is.array(e)?{value:e[0],label:e[1]}:ax.is.object(e)?e:{value:e,label:e}}):Object.keys(e).map(function(t){return{value:t,label:e[t]}}):[]},ax.extension.appkit.form.factory.lib.scopedName=function(e,t){if(!t.key)return"";let a=e.scope.concat(t.key),n=a.shift();return a.length?n+"["+a.join("][")+"]":n},ax.extension.appkit.report.factory.one=(e=>(function(t,a,n={}){let i=ax.a,o=ax.x;return ax.is["function"](a)&&(a=a(o.appkit.report.factory({data:n.data||e.data[t],scope:n.scope||e.scope.concat([t]),layout:n.layout||e.layout}))),i["appkit-report-field-one"](a)})),ax.extension.appkit.report.factory.many=(e=>(function(t,a,n={}){let i=ax.a,o=ax.x;if(ax.is["function"](a)){let i=n.data||e.data[n.key||t]||[],r=n.scope||e.scope.concat([t,""]),l=n.layout||e.layout,p=o.appkit.report.factory({data:i,scope:r,layout:l});p.items=(e=>o.appkit.report.factory.many.items(e)),p.add=(e=>o.appkit.report.factory.many.add(e)),a=a(p)}return i["appkit-report-field-many"](a)})),ax.extension.appkit.report.factory.field=(e=>(function(t={},a={}){ax.is.string(t)?a.key=t:a=t;let n=ax.a,i=ax.x,o=i.appkit.report.factory.field,r=i.appkit.lib.field.name.build(e.scope,a.key),l=n["appkit-report-field-group"]([o.caption(a),o.help(a.help),o.control(e)(a),o.hint(a.hint)],a.groupTag);return!1!==a.dependent&&(l=o.dependent(e)(l,a.dependent)),n["appkit-report-field"](l,{name:r,$match:function(){let e=this.$("appkit-report-field-dependent");return!e||e.$match()},$value:function(){return this.$("appkit-report-field-control > *").$value()},...a.fieldTag})})),ax.extension.appkit.report.factory.fields=(e=>(function(...t){return ax.a["appkit-report-fields"](t.map(function(t){return e.field(t)}))})),ax.extension.appkit.report.factory.checkboxes=(e=>(function(t={}){let a=ax.a,n=(ax.x,ax.x.appkit.lib.field),i=n.collection.name(t.name),o=n.collection.value(t.value),r=n.collection.from(t.collection).map(function(a,r){let l=t.check;return ax.is["function"](l)&&(l=l(a,r)),e.check({name:i,value:n.collection.includes(o,a.value)?a.value:"",checked:a.value,label:a.label,...l})});r.unshift(a.span({name:i,$value:function(){return t.value}}));let l={$value:function(){return t.value},...t.checkboxesTag};return a["appkit-report-checkboxes"](r,l)})),ax.extension.appkit.report.factory.check=(()=>(function(e={}){let t=e.checked||on,a=ax.a.input({name:e.name,value:t,checked:e.value==t,"class":e["class"],data:e.data,disabled:!0,id:e.id,readonly:e.readonly,required:e.required,style:e.style,title:e.title,type:e.type||checkbox,$value:function(){return this.checked?this.value:""},...e.inputTag});if(e.label){let t={$value:function(){return this.$("input").$value()},...e.labelTag},n=[a,e.label];return e.reverse&&n.reverse(),ax.a.label(n,t)}return a})),ax.extension.appkit.report.factory.link=(()=>(function(e={}){let t=ax.a;return t["appkit-report-link"](t.a(e.label||e.value,{href:e.value,...e.aTag}),{name:e.name,"class":e["class"],data:e.data,id:e.id,style:e.style,title:e.title,$value:function(){return e.value},...e.tag})})),ax.extension.appkit.report.factory.text=(()=>(function(e={}){let t=ax.a,a=ax.x,n=e.value;if(n&&e.type){let t=ax.is["function"](e.type)?e.type:a.appkit.lib.text.capitalize(e.type);n=new window[t](n),n=e.stringify?ax.is.string(e.stringify)?n[e.stringify]():n[e.stringify.method||"toString"](...e.stringify.arguments||[]):n.toString()}return n=ax.is.object(n)?JSON.stringify(n):n.toString(),t["appkit-report-text"]({name:e.name,"class":e["class"],data:e.data,id:e.id,style:e.style,title:e.title,$value:function(){return n},...n?{$text:n}:{$nodes:t["appkit-report-placeholder"](e.placeholder)},...e.textTag})})),ax.extension.appkit.report.factory.object=(()=>(function(e={}){let t=ax.a,a=ax.x;return t["appkit-report-object"]({name:e.name,"class":e["class"],data:e.data,id:e.id,placeholder:e.placeholder,style:e.style,title:e.title,$value:function(){return value},$nodes:a.appkit.put(e.value),...e.objectTag})})),ax.extension.appkit.report.factory.list=(()=>(function(e={}){let t,a=ax.a,n=(ax.x,ax.x.appkit.lib.field),i=n.collection.name(e.name),o=n.collection.value(e.value),r=e.type||"ul";t=e.item?e.item:e=>a.li(e,l(e));let l=e.liTag;return ax.is["function"](l)||(l=(()=>l)),a["appkit-report-list"](a[r]({name:i,"class":e["class"],data:e.data,id:e.id,placeholder:e.placeholder,style:e.style,title:e.title,$value:function(){return o},$nodes:o.map(t),...e.textTag}))})),ax.extension.appkit.report.factory.radios=(e=>(function(t={}){let a=ax.a,n=(ax.x,ax.x.appkit.lib.field.collection.from(t.collection).map(function(a,n){let i=t.check;return ax.is["function"](i)&&(i=i(checkbox,n)),e.check({name:t.name,type:"radio",value:t.value===a.value?a.value:"",checked:a.value,label:a.label,inputTag:{$value:function(){return this.$("^appkit-report-radios").$value()}},...i})})),i={$value:function(){let e=this.$("input:checked");return e?e.value:""},...t.radiosTag};return a["appkit-report-radios"](n,i)})),ax.extension.appkit.report.factory.media=(()=>(function(e={}){let t,a=ax.a,n=e.value,i=e.type||img;return t=n?i===video||i===audio?{$nodes:a.source({src:n})}:{src:n}:{
$nodes:a["appkit-report-placeholder"](e.placeholder)},a["appkit-report-media"](a[i]({name:e.name,"class":e["class"],data:e.data,id:e.id,placeholder:e.placeholder,style:e.style,title:e.title,$value:function(){return n},...!1===e.controls?{}:{controls:controls},...t,...e[i+"Tag"]},e.tag))})),ax.extension.appkit.lib.query.from.object=function(e,t={}){var a,n=[];for(a in e)if(e.hasOwnProperty(a)){var i=t.prefix?t.prefix+"["+a+"]":a,o=e[a];n.push(null!==o&&ax.is.object(o)?this.objectToQueryString(o,i):encodeURIComponent(i)+"="+encodeURIComponent(o))}return n.join("&")},ax.extension.appkit.lib.query.to.object=function(e){var t={};return e&&e.split("&").map(function(e){e=e.split("="),t[e[0]]=decodeURIComponent(e[1])}),t},ax.extension.appkit.lib.date.now.value=function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},ax.extension.appkit.lib.animate.fade.out=function(e,t={}){"none"!=e.style.display&&this.toggle(e,t)},ax.extension.appkit.lib.animate.fade["in"]=function(e,t={}){"none"===e.style.display&&this.toggle(e,t)},ax.extension.appkit.lib.animate.fade.toggle=function(e,t={}){let a;"none"===e.style.display?(a=!1,e.style.opacity=0,e.style.display=null):(a=!0,e.style.opacity=1);let n=+new Date,i=t.time||250,o=function(){e.style.opacity=+e.style.opacity+(a?-1:1)*(new Date-n)/i,n=+new Date,(a?+e.style.opacity>0:+e.style.opacity<1)?window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16):(a&&(e.style.display="none"),t.complete&&t.complete(e))};o()},ax.extension.appkit.form.factory.element.select.options=function(e){let t=ax.a;ax.x;return e.collection.map(function(a){let n,i=e.value;return n=ax.is.array(i)?i.some(function(e){return e==a.value}):i==a.value,t.option(a.label,{value:a.value,selected:n||undefined,...e.optionTag,...a.optionTag})})},ax.extension.appkit.form.factory.element.proxy.object={},ax.extension.appkit.form.factory.element.proxy.shim={get:(e,t)=>{let a=ax.x;return e=>a.appkit.form.factory.element[t](e)}},ax.extension.appkit.form.factory.field.dependent=(e=>(function(t,a){let n=ax.a,i=ax.x,o=i.appkit.form.factory.field.dependent;ax.extension.appkit.form.factory.field.dependent.dependency.previous,ax.is.string(a)?a={key:a}:1==a?a={traverse:i.appkit.form.factory.field.dependent.dependency.previous}:ax.is.object(a)?a.key||a.name||a.selector||(a={traverse:i.appkit.form.factory.field.dependent.dependency.previous,...a}):a={};let r={style:"display: none;",$init:function(){this.$process()},$dependable:function(){return a.key||a.name||a.selector||a.traverse},$dependency:function(){return o.dependency(e).bind(this)(a)},$match:function(){return o.match.bind(this)(a)},$process:function(){return o.process.bind(this)(a)},...a.dependentTag};return n["appkit-form-field-dependent"](t,r)})),ax.extension.appkit.form.factory.field.header=function(e={}){if(0==e.header||ax.is.undefined(e.header)&&"hidden"==e.type)return null;{let t;if(1==e.header&&(e.header=null),e.header)t=header;else{let a=this.header.label(e);t=e.help?[a,this.header.helpbutton(e)]:a}return ax.a["appkit-form-field-header"](t,{...e.headerTag})}},ax.extension.appkit.form.factory.field.help=function(e){let t=ax.a,a=ax.x;return t["appkit-form-field-help-wrapper"](t["appkit-form-field-help"](e,{$toggle:function(){a.appkit.lib.animate.fade.toggle(this)},style:{display:"none"}}))},ax.extension.appkit.form.factory.field.hint=function(e){return ax.a["appkit-form-field-hint"](e)},ax.extension.appkit.report.factory.many.items=(e=>(function(t,a={}){let n=ax.a,i=ax.x;if(ax.is["function"](t)){let o=a.data||e.$data,r=a.scope||e.$scope,l=a.layout||e.$layout,p=t;return t=o.map(function(e,a){let o=i.appkit.report.factory({data:e,scope:r,layout:l});return o.remove=(e=>i.appkit.report.factory.many.remove(e)),n["appkit-report-field-many-item"](t(o,a))}),n["appkit-report-field-many-items"](t,{$add:function(e){let t=a["new"]&&a["new"]()||{},o=i.appkit.report.factory({data:t,scope:r,layout:l});o.remove=(e=>i.appkit.report.factory.many.remove(e));let s=n["appkit-report-field-many-item"](p(o,null));this[e.insert||"append"](s)}})}return n["appkit-report-field-items"](t)})),ax.extension.appkit.report.factory.many.add=(()=>(function(e,t={}){ax.a;return ax.x.appkit.button(e||"\u2795 Add",function(){this.$("^appkit-report-field-many appkit-report-field-many-items").$add(t)})})),ax.extension.appkit.report.factory.many.remove=(()=>(function(e){ax.a;return ax.x.appkit.button(e||"\u2796 Remove",function(){confirm("Are you sure that you want to remove this item?")&&this.$("^appkit-report-field-many-item").remove()})})),ax.extension.appkit.report.factory.field.control=(e=>(function(t){let a=ax.a,n=(ax.x,t.as||"text"),i=e.data&&(e.data[t.key]||(0===e.data[t.key]?0:null))||t.value;return t.collectionParam?collection=f.params[t.collectionParam]:collection=t.collection,a["appkit-report-field-control"](e[n]({name:t.name,value:i,type:t.type,collection:t.collection,stringify:t.stringify,...t[n]}),t.controlTag)})),ax.extension.appkit.report.factory.field.dependent=(e=>(function(t,a={}){let n=ax.a,i=ax.x.appkit.report.factory.field.dependent;ax.is.string(a)&&(a={key:a});let o={style:"display: none;",$init:function(){this.$process()},$on:{"change: check field dependencies":function(){this.$("^appkit-report").$$("appkit-report-field-dependent").$process()}},$dependable:function(){return a.key||a.name||a.selector||a.traverse},$dependency:function(){return i.dependency(e).bind(this)(a)},$match:function(){return i.match.bind(this)(a)},$process:function(){return i.process.bind(this)(a)},...a.dependentTag};return n["appkit-report-field-dependent"](t,o)})),ax.extension.appkit.report.factory.field.help=function(e){let t=ax.a,a=ax.x;return t["appkit-report-field-help-wrapper"](t["appkit-report-field-help"](e,{$toggle:function(){a.appkit.lib.animate.fade.toggle(this)},style:{display:"none"}}))},ax.extension.appkit.report.factory.field.caption=function(e={}){let t;if(e.caption)t=caption;else{let a=this.caption.label(e);t=e.help?[a,this.caption.helpbutton(e)]:a}return ax.a["appkit-report-field-caption"](t,{...e.captionTag})},ax.extension.appkit.report.factory.field.hint=function(e){return ax.a["appkit-report-field-hint"](e)},ax.extension.appkit.form.factory.field.header.label=function(e){let t=ax.a,a=ax.x.appkit.lib;if(0==e.label)return null;let n=e.label||a.text.labelize(e.key),i=t.label(n,e.labelTag),o={$on:{"click: focus on input":function(){let e=this.$("^appkit-form-field-control","appkit-form-field > *");e&&e.$focus()}},...e.labelWrapperTag};return t["appkit-form-field-label-wrapper"](i,o)},ax.extension.appkit.form.factory.field.header.helpbutton=function(e){let t=ax.a;ax.x;return t["appkit-form-field-helpbutton"]({$state:!1,$nodes:function(){return t["appkit-form-field-helpbutton-text"]({$text:this.$state?" \u2753 \u2716 ":" \u2753 "})},$on:{"click: toggle help":function(){this.$state=!this.$state,this.$("^appkit-form-field","appkit-form-field-help").$toggle()}},...e.helpbuttonTag})},ax.extension.appkit.form.factory.field.dependent.process=function(e){let t=ax.x.appkit.lib.animate;this.$match()?e.onmatch&&!e.onmatch(this)||(t.fade["in"](this),this.$("appkit-form-control > *").$enable()):e.onmismatch&&!e.onmismatch(this)||(this.style.display="none",this.$("appkit-form-control > *").$disable,this.$("appkit-form-control > *").$disable())},ax.extension.appkit.form.factory.field.dependent.dependency=(e=>(function(t){let a,n=ax.x.appkit.lib.field;if(t.traverse)a=t.traverse.bind(this)(this);else{let i;if(t.selector)i=t.selector;else{let a;t.key?a=n.name.assemble(...e.scope,t.key):t.name?a=t.name:ax.log.error("Field `options.dependent` needs a `key`, `name`, `selector` or `traverse`."),i=`appkit-form-field[name='${a}']`}let o=t.search||"^appkit-form";a=this.$(o).$(i)}if(a){if("appkit-form-field"!==a.$tag&&(a=a.$("^appkit-form-field")),a)return a;ax.log.error("Form field failed to find <appkit-form-field> for its dependency using options:",t)}else ax.log.error("Form field failed to select its dependency using options:",t)})),ax.extension.appkit.form.factory.field.dependent.match=function(e){if(this.$dependable()){let t=this.$dependency();if(t.$match()){let a=t.$value();return e.value?a==e.value:e.pattern?new RegExp(e.pattern||"").test(a.toString()):!!a}return!1}return!0},ax.extension.appkit.report.factory.field.dependent.process=function(e){let t=ax.x.appkit.lib.animate;this.$match()?e.onmatch&&!e.onmatch(this)||t.fade["in"](this):e.onmismatch&&!e.onmismatch(this)||t.fade.out(this)},ax.extension.appkit.report.factory.field.dependent.dependency=(e=>(function(t){let a,n=ax.x.appkit.lib.field;if(t.traverse)field=this.$("^"),a=t.traverse.bind(field)(field);else{let i;if(t.selector)i=t.selector;else{let a;t.key?a=n.name.assemble(...e.scope,t.key):t.name?a=t.name:ax.log.error("Field `options.dependent` needs a `key`, `name`, `selector` or `traverse`."),i=`appkit-report-field[name='${a}']`}let o=t.search||"appkit-report";a=this.$(`^${o}`).$(i)}if(a){if("appkit-report-field"!==a.$tag&&(a=a.$("^appkit-report-field")),a)return a;ax.log.error(`Report field failed to find <appkit-report-field> for its dependency using ${JSON.stringify(t)}.`)}else ax.log.error(`Report field failed to select its dependency using ${JSON.stringify(t)}.`)})),ax.extension.appkit.report.factory.field.dependent.match=function(e){if(this.$dependable()){let t=this.$dependency();if(t.$match()){let a=t.$value();return ax.is.array(a)&&(a=a.join(" ")),e.value?a==e.value:e.pattern?new RegExp(e.pattern||"").test(a):!!a}return!1}return!0},ax.extension.appkit.report.factory.field.caption.label=function(e){let t=ax.a,a=ax.x.appkit.lib;if(!1===e.label)return;let n=[e.label||a.text.labelize(e.key)];e.wrapperTag;return t["appkit-report-field-label-wrapper"](n,e.wrapperTag)},ax.extension.appkit.report.factory.field.caption.helpbutton=function(e){let t=ax.a;ax.x;return t["appkit-report-field-helpbutton"]({$state:!1,$nodes:function(){return t["appkit-report-field-helpbutton-text"]({$text:this.$state?" \u2753 \u2716 ":" \u2753 "})},$on:{"click: toggle help":function(){this.$state=!this.$state,this.$("^appkit-report-field","appkit-report-field-help").$toggle()}},...e.helpbuttonTag})},ax.extension.appkit.form.factory.field.dependent.dependency.previous=function(e){let t=e.$("^appkit-form-section").$$("appkit-form-field").$$;e=e.$("^appkit-form-field");let a=t.indexOf(e),n=t.length;return 0==a||n<2?e:t[a-1]},ax.extension.appkit.form.factory.field.dependent.dependency.next=function(e){let t=e.$("^appkit-form-section").$$("appkit-form-field").$$;e=e.$("^appkit-form-field");let a=t.indexOf(e),n=t.length;return a==n-1||n<2?e:t[a+1]},ax.extension.xtermjs=((e={})=>t=>t["axf-xtermjs"]({$nodes:[t["axf-xtermjs-toolbar"]([t["axf-xtermjs-toolbar-left"](e.label),t["axf-xtermjs-toolbar-right"](t["axf-xtermjs-fullscreen"](t.button({$text:"\ud83d\uddd6"},{type:"button",$on:{"click: toggle full screen":function(){let e=this.$("^axf-xtermjs");e.$fullscreen=!e.$fullscreen,e.$fullscreen?(this.$text="\ud83d\uddd7",this.$("^body").style.overflowY="hidden",this.$("^body").querySelectorAll("axf-xtermjs").forEach(e=>{e!=this.$("^axf-xtermjs")&&(e.$("axf-xtermjs-container").style.display="none")}),e.$("^axf-xtermjs").classList.add("fullscreen")):(this.$text="\ud83d\uddd6",this.$("^body").style.overflowY="auto",this.$("^body").querySelectorAll("axf-xtermjs").forEach(e=>{e.$("axf-xtermjs-container").style.display=""}),e.$("^axf-xtermjs").classList.remove("fullscreen")),e.$xterm.toggleFullScreen(e.$fullscreen),e.$xterm.fit()}}})))],e.toolbarTag),t["axf-xtermjs-container"]],$init:function(){const t=function(){this.$xterm.fit()}.bind(this);window.addEventListener("resize",t),Terminal.applyAddon(fullscreen),Terminal.applyAddon(fit),this.$xterm=new Terminal(e.terminal),this.$xterm.open(this.$("axf-xtermjs-container")),this.$xterm.write(e.text||""),t()},$on:{},$write:function(e){this.$xterm.write(e)},...e.terminalTag})),ax.css({"axf-xtermjs":{display:"block",height:"calc( 300px + 1.8rem )","&.fullscreen":{height:"calc( 100vh - 1.8rem - 3px )",marginTop:"calc( 1.8rem + 4px )",position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:1,"axf-xtermjs-toolbar":{zIndex:"257",position:"fixed",top:0,left:0,right:0},"axf-xtermjs-container":{height:"100%",".xterm-screen":{marginTop:"1.8rem"}}},"axf-xtermjs-container":{display:"block",height:"300px"},"axf-xtermjs-toolbar":{display:"block",overflow:"auto",backgroundColor:"white",border:"1px solid #e6e6e6",borderBottom:"none",button:{fontSize:"1.2rem",border:"none",backgroundColor:"transparent",cursor:"pointer"}},"axf-xtermjs-toolbar-right":{float:"right"},"axf-xtermjs-toolbar-left":{lineHeight:"1.8",paddingLeft:"5px"}}}),ax.extension.chartjs=function(e,t={}){var a=ax.a,n=Object.assign({style:"display: block;"},t.chartTag||{}),i=Object.assign({style:"display: block;"},t.canvasTag||{});return a.chart([a.div(null,{$init:function(){this.parentElement.$chart=new Chart(this.nextSibling.getContext("2d"),e)}}),a.canvas(null,i)],n)},ax.extension.chart=ax.extension.chartjs,ax.extension.panes=function(e,t,a={}){function n(e){const t=e.target.$("^axf-panes");let n,o=a.vertical;if(o){n=100*(t.clientHeight-(e.clientY-t.offsetTop))/t.clientHeight}else{n=100*(1-(t.clientWidth-(e.clientX-t.offsetLeft))/t.clientWidth)}i(t,n,o)}function i(e,t,a){const n=e.$("axf-panes-proximate"),i=e.$("axf-panes-adjacent"),o=e.$("axf-panes-drag");t=Number(t||50),Number.isNaN(t)&&(t=50),t>90&&(t=90),t<10&&(t=10),a?(n.style.bottom=`calc( ${100-t}% + 2px )`,i.style.top=`calc( ${t}% + 2px )`,o.style.top=`calc( ${t}% - 2px )`):(n.style.right=`calc( ${100-t}% + 2px )`,i.style.left=`calc( ${t}% + 2px )`,o.style.left=`calc( ${t}% - 2px )`),e.$send("resize",{detail:{percent:t}})}function o(e){e.target.$("^axf-panes").classList.remove("dragable"),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)}const r=ax.a,l=a.vertical?"vertical":"horizontal";return r["axf-panes"]([r["axf-panes-proximate"](e),r["axf-panes-drag"]({$on:{mousedown:(e,t)=>{t.$("^axf-panes").classList.add("dragable"),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}}}),r["axf-panes-adjacent"](t)],{"class":l,$init:function(){i(this,a.percent,a.vertical)},...a.panesTag})},ax.css({"axf-panes":{position:"fixed",top:0,left:0,right:0,bottom:0,"axf-panes-proximate":{display:"block",position:"absolute",left:0,top:0,bottom:0,right:"calc( 50% + 2px )",overflowY:"auto",overflowX:"hidden"},"axf-panes-adjacent":{display:"block",position:"absolute",right:0,top:0,bottom:0,left:"calc( 50% + 2px )",overflowY:"auto",overflowX:"hidden"},"axf-panes-drag":{display:"block",position:"absolute",left:"calc( 50% - 2px )",top:0,bottom:0,width:"4px",background:"#0001","&:hover":{background:"#ddd"}},"&.dragable":{cursor:"grabbing","axf-panes-drag":{background:"#aaa"}},"&:not(.dragable)":{"axf-panes-drag":{cursor:"ew-resize"}},"&.vertical":{"axf-panes-proximate":{bottom:"calc( 50% + 2px )",right:0},"axf-panes-adjacent":{left:0,top:"calc( 50% + 2px )"},"axf-panes-drag":{display:"block",position:"absolute",top:"calc( 50% - 2px )",left:0,right:0,height:"4px",width:"100%",background:"#eee"},"&:not(.dragable)":{"axf-panes-drag":{cursor:"ns-resize"}}}}}),"undefined"!=typeof Dropzone&&(Dropzone.autoDiscover=!1),ax.extension.dropzone=((e={})=>{let t=e.url||"/";return ax.a["axf-dropzonejs"]({"class":"dropzone",$init:a=>{a.$dropzone=new Dropzone(a,{url:t,...e.dropzone})},...e.tag})}),ax.css({"axf-dropzonejs":{display:"block","&.dropzone":{"&.dz-clickable":{minHeight:"250px"},".dz-preview.dz-file-preview":{display:"block",margin:0,".dz-error-message":{width:"50%",left:0,top:"250px"},"&:after":{left:"5px"},".dz-image":{minHeight:"250px",width:"100%",background:"linear-gradient(to bottom, #4488dd80, #48d)"},".dz-progress":{width:"calc( 100% - 40px )",marginTop:"-15px",left:"60px",height:"30px",".dz-upload":{background:"#48d"}},".dz-details":{".dz-size":{marginBottom:"160px"}}}}}});